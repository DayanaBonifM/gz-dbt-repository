version: 2

sources:
  - name: raw
    database: molten-nirvana-477615-c9
    schema: gz_raw_data
    loader: bigquery
    description: "Raw dataset containing uncleaned Greenweez data."
    freshness:
      warn_after: {  count: 90, period: day }
    tables:
      - name: sales
        identifier: raw_gz_sales
        description: "Sales of Greenweez. One row per product_id per orders_id."
        config:
          loaded_at_field: "CAST(date_date AS TIMESTAMP)"
        freshness:
          warn_after: { count: 90, period: day }
  
        columns:
          - name: date_date
            description: "Date of purchase."

          - name: orders_id
            description: "Order identifier."

          - name: pdt_id
            description: "Product identifier."

          - name: revenue
            description: "Revenue generated by this product in this order."

          - name: quantity
            description: "Quantity purchased."

        tests:
          - unique:
              column_name: concat(orders_id, pdt_id)
          - not_null:
              column_name: orders_id
          - not_null:
              column_name: pdt_id

      - name: product
        identifier: raw_gz_product
        description: "Product catalog of Greenweez."

        columns:
          - name: products_id
            description: "Primary key of the product table."
            tests:
              - unique
              - not_null

          - name: purchase_price
            description: "Purchase price of the product."

          - name: product_name
            description: "Name of the product."

          - name: category
            description: "Category of the product."

      - name: ship
        identifier: raw_gz_ship
        description: "Shipping information for each order."

        columns:
          - name: orders_id
            description: "Primary key of the shipping table."
            tests:
              - unique
              - not_null

          - name: shipping_fee
            description: "Shipping fee charged to the customer."

          - name: ship_cost
            description: "Internal shipping cost."

          - name: log_cost
            description: "the cost of preparing the parcel in the distribution centre/warehouse"

          - name: shipping_date
            description: "Date when the order was shipped."

      - name: adwords
        identifier: raw_gz_adwords
        description: "Google Adwords advertising data."

      - name: bing
        identifier: raw_gz_bing
        description: "Bing advertising data."

      - name: criteo
        identifier: raw_gz_criteo
        description: "Criteo advertising data."

      - name: facebook
        identifier: raw_gz_facebook
        description: "Facebook advertising data."
models:
  - name: int_campaigns
    description: "Intermediate model that combines all ad campaign sources into a single table."
    columns:
      - name: date_date
        description: "Date of the campaign metrics."
        tests:
          - not_null

      - name: paid_source
        description: "Type of add"

      - name: campaign_key
        description: "Unique identifier of the advertising campaign."
        tests:
          - not_null

      - name: campaign_name
        description: "Name of the advertising campaign."
        tests:
          - not_null

      - name: ads_cost
        description: "Cost of ads for this campaign and date."
        tests:
          - not_null

      - name: impression
        description: "nb of impressions"

      - name: click
        description: "nb of clicks"
  
  - name: finance_campaigns_day
    description: "Daily financial metrics enriched with advertising performance and cost."
    columns:
      - name: date
        description: "Date of the aggregated metrics."
        tests:
          - not_null
          - unique

      - name: ads_margin
        description: "Operational margin minus advertising cost."

      - name: average_basket
        description: "average basket"
      
      - name: operational_margin
        description: "operational margin"

      - name: ads_cost
        description: "Total advertising cost for the day."

      - name: ads_impression
        description: "Total impressions from all campaigns."

      - name: ads_clicks
        description: "Total clicks from all campaigns."

      - name: revenue
        description: "Total revenue for the day."

      - name: quantity
        description: "Total quantity sold for the day."

      - name: revenue
        description: "revenue"
      
      - name: purchase_cost
        description: "purchase cost"
      
      - name: margin
      - name: shipping_fee
      - name: log_cost
      - name: ship_cost